# äº¤äº’å¼æ³•å¾‹é£é™©è¯„ä¼°ç³»ç»Ÿå®ç°æ–¹æ¡ˆ

## æ–‡æ¡£ä¿¡æ¯
- **ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2026-01-20
- **ä½œè€…**: AI Assistant
- **çŠ¶æ€**: è®¾è®¡é˜¶æ®µ

---

## ç›®å½•
1. [æ–¹æ¡ˆæ¦‚è¿°](#1-æ–¹æ¡ˆæ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#2-æ¶æ„è®¾è®¡)
3. [æ ¸å¿ƒç»„ä»¶è®¾è®¡](#3-æ ¸å¿ƒç»„ä»¶è®¾è®¡)
4. [äº¤äº’æµç¨‹è®¾è®¡](#4-äº¤äº’æµç¨‹è®¾è®¡)
5. [æç¤ºè¯å·¥ç¨‹](#5-æç¤ºè¯å·¥ç¨‹)
6. [åç«¯å®ç°](#6-åç«¯å®ç°)
7. [å‰ç«¯å®ç°](#7-å‰ç«¯å®ç°)
8. [æ•°æ®åº“è®¾è®¡](#8-æ•°æ®åº“è®¾è®¡)
9. [éƒ¨ç½²æ–¹æ¡ˆ](#9-éƒ¨ç½²æ–¹æ¡ˆ)
10. [æµ‹è¯•è®¡åˆ’](#10-æµ‹è¯•è®¡åˆ’)

---

## 1. æ–¹æ¡ˆæ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

å°†ç°æœ‰çš„"ä¸€æ¬¡æ€§è¾“å‡ºå®Œæ•´æŠ¥å‘Š"æ¨¡å¼æ”¹é€ ä¸º"æ¸è¿›å¼äº¤äº’è¯„ä¼°"æ¨¡å¼ï¼š

- âœ… **ç”¨æˆ·ä¸»å¯¼**ï¼šç”¨æˆ·å†³å®šè¯„ä¼°çš„æ·±åº¦å’Œæ–¹å‘
- âœ… **æ¸è¿›å¼æŠ«éœ²**ï¼šå…ˆæ¦‚è§ˆåè¯¦æƒ…ï¼Œé¿å…ä¿¡æ¯è¿‡è½½
- âœ… **åŒå‘äº¤äº’**ï¼šé€šè¿‡é—®ç­”æ”¶é›†ä¿¡æ¯ï¼Œé’ˆå¯¹æ€§åˆ†æ
- âœ… **çµæ´»è¾“å‡º**ï¼šç”¨æˆ·å†³å®šæ˜¯å¦ç”Ÿæˆæ­£å¼æŠ¥å‘Š

### 1.2 æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **åˆ†æ­¥äº¤äº’** | åˆ†5ä¸ªé˜¶æ®µé€æ­¥æ”¶é›†ä¿¡æ¯å’Œå±•ç¤ºç»“æœ |
| **ä¿¡æ¯åˆ†å±‚** | æ¦‚è§ˆ â†’ è¯¦æƒ… â†’ æ·±åº¦åˆ†æ ä¸‰å±‚ä¿¡æ¯æ¶æ„ |
| **å¯è§†åŒ–å‘ˆç°** | ä½¿ç”¨emojiã€å›¾æ ‡ã€è¿›åº¦æ¡ç­‰æå‡å¯è¯»æ€§ |
| **çŠ¶æ€è®°å¿†** | ä¿å­˜è¯„ä¼°è¿›åº¦ï¼Œæ”¯æŒä¸­æ–­å’Œæ¢å¤ |
| **æŒ‰éœ€æŠ¥å‘Š** | ä»…åœ¨ç”¨æˆ·æ˜ç¡®è¦æ±‚æ—¶ç”Ÿæˆå®Œæ•´æŠ¥å‘Š |

### 1.3 ä¸ç°æœ‰æ–¹æ¡ˆçš„å¯¹æ¯”

| ç»´åº¦ | ç°æœ‰æ–¹æ¡ˆ | æ–°æ–¹æ¡ˆ |
|------|---------|--------|
| äº¤äº’æ–¹å¼ | å•å‘è¾“å‡º | åŒå‘å¯¹è¯ |
| ä¿¡æ¯å‘ˆç° | ä¸€æ¬¡æ€§å®Œæ•´æŠ¥å‘Š | æ¸è¿›å¼åˆ†å±‚å±•ç¤º |
| ç”¨æˆ·å‚ä¸ | è¢«åŠ¨æ¥æ”¶ | ä¸»åŠ¨å¼•å¯¼ |
| çµæ´»æ€§ | å›ºå®šæµç¨‹ | æŒ‰éœ€å®šåˆ¶ |
| æŠ¥å‘Šç”Ÿæˆ | è‡ªåŠ¨ç”Ÿæˆ | ç”¨æˆ·ç¡®è®¤åç”Ÿæˆ |

---

## 2. æ¶æ„è®¾è®¡

### 2.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ èŠå¤©ç•Œé¢  â”‚  â”‚ é£é™©å¡ç‰‡  â”‚  â”‚ è¿›åº¦æŒ‡ç¤º  â”‚  â”‚ æŠ¥å‘Šé¢„è§ˆ  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API ç½‘å…³å±‚                              â”‚
â”‚              ChatController / AssessmentController          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ä¸šåŠ¡æœåŠ¡å±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ AssessmentService â”‚  â”‚ SessionService   â”‚               â”‚
â”‚  â”‚  - è¯„ä¼°æµç¨‹æ§åˆ¶   â”‚  â”‚  - ä¼šè¯çŠ¶æ€ç®¡ç†  â”‚               â”‚
â”‚  â”‚  - å·¥å…·é“¾ç¼–æ’     â”‚  â”‚  - ä¸Šä¸‹æ–‡å­˜å‚¨    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Agent å¼•æ“å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          InteractiveRiskAssessmentAgent               â”‚  â”‚
â”‚  â”‚  - ReActæ¡†æ¶                                          â”‚  â”‚
â”‚  â”‚  - å·¥å…·é›†: FileTool, DateTool, RiskTool              â”‚  â”‚
â”‚  â”‚  - è®°å¿†ç®¡ç†: ShortMemory, LongMemory                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ•°æ®å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ MySQL    â”‚  â”‚ MinIO    â”‚  â”‚ Redis    â”‚  â”‚ Milvus   â”‚   â”‚
â”‚  â”‚ ä¼šè¯æ•°æ®  â”‚  â”‚ æ–‡ä»¶å­˜å‚¨  â”‚  â”‚ ç¼“å­˜     â”‚  â”‚ å‘é‡æ£€ç´¢  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç”¨é€” |
|------|------|------|
| å‰ç«¯ | React + TypeScript | ç”¨æˆ·ç•Œé¢ |
| åç«¯ | Spring Boot | ä¸šåŠ¡é€»è¾‘ |
| Agentæ¡†æ¶ | AgentScope (ReAct) | æ™ºèƒ½å¯¹è¯ |
| æ•°æ®åº“ | MySQL | ä¼šè¯æŒä¹…åŒ– |
| ç¼“å­˜ | Redis | å®æ—¶ä¸Šä¸‹æ–‡ |
| æ–‡ä»¶å­˜å‚¨ | MinIO | æ–‡æ¡£/æŠ¥å‘Šå­˜å‚¨ |
| å‘é‡æ•°æ®åº“ | Milvus | çŸ¥è¯†æ£€ç´¢ |

---

## 3. æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 3.1 AssessmentSessionï¼ˆè¯„ä¼°ä¼šè¯ï¼‰

```java
/**
 * è¯„ä¼°ä¼šè¯å®ä½“
 */
@Data
@TableName("assessment_session")
public class AssessmentSession {
    @TableId(type = IdType.AUTO)
    private Long id;

    @TableField("chat_id")
    private String chatId;           // å¯¹è¯ID

    @TableField("user_id")
    private Long userId;             // ç”¨æˆ·ID

    @TableField("session_id")
    private String sessionId;        // ä¼šè¯å”¯ä¸€æ ‡è¯†

    @TableField("current_stage")
    private String currentStage;     // å½“å‰é˜¶æ®µ: INIT/COLLECTING/ANALYZING/REVIEWING/COMPLETED

    @TableField("assessment_type")
    private String assessmentType;   // è¯„ä¼°ç±»å‹: CONTRACT/COMPLIANCE/LITIGATION

    @TableField("context_json")
    private String contextJson;      // ä¼šè¯ä¸Šä¸‹æ–‡ï¼ˆJSONæ ¼å¼ï¼‰

    @TableField("file_ids")
    private String fileIds;          // å…³è”çš„æ–‡ä»¶IDåˆ—è¡¨

    @TableField("status")
    private String status;           // çŠ¶æ€: ACTIVE/PAUSED/COMPLETED

    @TableField(value = "created_at", fill = FieldFill.INSERT)
    private LocalDateTime createdAt;

    @TableField("updated_at")
    private LocalDateTime updatedAt;
}
```

### 3.2 AssessmentContextï¼ˆè¯„ä¼°ä¸Šä¸‹æ–‡ï¼‰

```java
/**
 * è¯„ä¼°ä¸Šä¸‹æ–‡ - å­˜å‚¨è¯„ä¼°è¿‡ç¨‹ä¸­çš„å…³é”®ä¿¡æ¯
 */
@Data
public class AssessmentContext {
    // åŸºæœ¬ä¿¡æ¯
    private String assessmentType;       // è¯„ä¼°ç±»å‹
    private String userFocus;            // ç”¨æˆ·å…³æ³¨ç‚¹
    private List<String> documentIds;    // æ–‡æ¡£IDåˆ—è¡¨

    // æ”¶é›†çš„ä¿¡æ¯
    private Map<String, Object> collectedInfo;

    // åˆ†æç»“æœ
    private RiskAssessmentResult preliminaryResult;  // åˆæ­¥åˆ†æç»“æœ
    private Map<String, RiskDetail> riskDetails;     // è¯¦ç»†é£é™©åˆ†æ

    // ç”¨æˆ·åå¥½
    private boolean needDetailedAnalysis;   // æ˜¯å¦éœ€è¦è¯¦ç»†åˆ†æ
    private boolean needReport;             // æ˜¯å¦éœ€è¦ç”ŸæˆæŠ¥å‘Š
    private List<String> interestedTopics;  // ç”¨æˆ·æ„Ÿå…´è¶£çš„ä¸»é¢˜

    // è¯„ä¼°å…ƒæ•°æ®
    private LocalDateTime startTime;
    private String currentPhase;
    private int iterationCount;
}
```

### 3.3 RiskAssessmentResultï¼ˆè¯„ä¼°ç»“æœï¼‰

```java
/**
 * é£é™©è¯„ä¼°ç»“æœ
 */
@Data
public class RiskAssessmentResult {
    private String riskLevel;              // é£é™©ç­‰çº§: HIGH/MEDIUM/LOW
    private int riskScore;                 // é£é™©è¯„åˆ† 0-100

    private List<RiskItem> highRisks;      // é«˜é£é™©é¡¹
    private List<RiskItem> mediumRisks;    // ä¸­é£é™©é¡¹
    private List<RiskItem> lowRisks;       // ä½é£é™©é¡¹

    private List<String> keyFindings;      // å…³é”®å‘ç°ï¼ˆ3æ¡ï¼‰
    private String summary;                // æ¦‚è¦æ€»ç»“

    @Data
    public static class RiskItem {
        private String category;           // é£é™©ç±»åˆ«
        private String description;        // é£é™©æè¿°
        private String impact;             // å½±å“ç¨‹åº¦
        private String suggestion;         // æ”¹è¿›å»ºè®®
        private String severity;           // ä¸¥é‡ç¨‹åº¦
    }
}
```

---

## 4. äº¤äº’æµç¨‹è®¾è®¡

### 4.1 äº”é˜¶æ®µäº¤äº’æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é˜¶æ®µ1: éœ€æ±‚ç¡®è®¤ (INIT)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Agent: "æ‚¨å¥½ï¼æˆ‘å¯ä»¥å¸®æ‚¨è¿›è¡Œæ³•å¾‹é£é™©è¯„ä¼°ã€‚è¯·é—®æ‚¨æƒ³è¯„ä¼°ä»€ä¹ˆï¼Ÿ   â”‚
â”‚          1. åˆåŒé£é™©  2. åˆè§„å®¡æŸ¥  3. è¯‰è®¼é£é™©  4. å…¶ä»–"        â”‚
â”‚                                                                  â”‚
â”‚  User: "æˆ‘æƒ³è¯„ä¼°è¿™ä»½åˆåŒçš„é£é™©"                                   â”‚
â”‚  Agent: "å¥½çš„ï¼Œè¯·ä¸Šä¼ åˆåŒæ–‡æ¡£ã€‚æ‚¨æœ€å…³å¿ƒåˆåŒçš„å“ªäº›æ–¹é¢ï¼Ÿ"          â”‚
â”‚          "ã€ä»˜æ¬¾æ¡æ¬¾ã€‘ã€è¿çº¦è´£ä»»ã€‘ã€äº‰è®®è§£å†³ã€‘ã€å…¶ä»–ã€‘"           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   é˜¶æ®µ2: ä¿¡æ¯æ”¶é›† (COLLECTING)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Agent: "æ”¶åˆ°æ–‡æ¡£ã€‚è®©æˆ‘å…ˆå¿«é€Ÿæµè§ˆä¸€ä¸‹..."                         â”‚
â”‚          [è°ƒç”¨ getFileContent å·¥å…·]                              â”‚
â”‚                                                                  â”‚
â”‚  Agent: "ä¸ºäº†æ›´å‡†ç¡®åœ°è¯„ä¼°ï¼Œæˆ‘è¿˜éœ€è¦äº†è§£ï¼š                         â”‚
â”‚          1. è¿™ä»½åˆåŒçš„äº¤æ˜“é‡‘é¢å¤§æ¦‚æ˜¯å¤šå°‘ï¼Ÿ                        â”‚
â”‚          2. æ‚¨åœ¨äº¤æ˜“ä¸­çš„è§’è‰²æ˜¯ä¹°æ–¹è¿˜æ˜¯å–æ–¹ï¼Ÿ"                     â”‚
â”‚                                                                  â”‚
â”‚  User: "é‡‘é¢50ä¸‡ï¼Œæˆ‘æ˜¯ä¹°æ–¹"                                       â”‚
â”‚  Agent: "æ˜ç™½äº†ã€‚è¿˜æœ‰å…¶ä»–éœ€è¦æˆ‘äº†è§£çš„å—ï¼Ÿ"                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   é˜¶æ®µ3: åˆæ­¥åˆ†æ (ANALYZING)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Agent: "ğŸ“Š é£é™©å¿«é€Ÿè¯„ä¼°                                          â”‚
â”‚                                                                  â”‚
â”‚          ğŸš¨ é£é™©ç­‰çº§: ä¸­ç­‰ (é£é™©è¯„åˆ†: 65/100)                    â”‚
â”‚                                                                  â”‚
â”‚          âš ï¸ å…³é”®å‘ç°:                                            â”‚
â”‚          1. ä»˜æ¬¾æ¡æ¬¾å­˜åœ¨é£é™© - çº¦å®šåˆ†3æœŸä½†æœªæ˜ç¡®å…·ä½“æ—¥æœŸ          â”‚
â”‚          2. è¿çº¦é‡‘æ¯”ä¾‹çº¦å®šä¸æ˜ç¡® - å¯èƒ½å¯¼è‡´è¿½è´£å›°éš¾              â”‚
â”‚          3. äº‰è®®è§£å†³æ¡æ¬¾è¾ƒå®Œå–„ âœ…                                â”‚
â”‚                                                                  â”‚
â”‚          æ‚¨æƒ³æ·±å…¥äº†è§£å“ªä¸ªæ–¹é¢ï¼Ÿè¿˜æ˜¯ç»§ç»­è¯„ä¼°å…¶ä»–é£é™©ç‚¹ï¼Ÿ"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   é˜¶æ®µ4: äº¤äº’æ·±å…¥ (REVIEWING)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  User: "è¯¦ç»†åˆ†æä¸€ä¸‹ä»˜æ¬¾æ¡æ¬¾"                                     â”‚
â”‚                                                                  â”‚
â”‚  Agent: "ğŸ“„ ä»˜æ¬¾æ¡æ¬¾è¯¦ç»†åˆ†æ                                      â”‚
â”‚                                                                  â”‚
â”‚          ğŸ” å½“å‰çº¦å®š:                                            â”‚
â”‚          ã€Œç”²æ–¹åº”åˆ†ä¸‰æœŸå‘ä¹™æ–¹æ”¯ä»˜æ¬¾é¡¹...ã€                        â”‚
â”‚                                                                  â”‚
â”‚          âš ï¸ é£é™©ç‚¹:                                              â”‚
â”‚          â€¢ æœªçº¦å®šæ¯æœŸä»˜æ¬¾çš„å…·ä½“æ—¥æœŸ                               â”‚
â”‚          â€¢ æœªçº¦å®šé€¾æœŸä»˜æ¬¾çš„è¿çº¦è´£ä»»                               â”‚
â”‚          â€¢ ç¼ºå°‘ä»˜æ¬¾æ¡ä»¶ï¼ˆå¦‚éªŒæ”¶æ ‡å‡†ï¼‰                             â”‚
â”‚                                                                  â”‚
â”‚          ğŸ’¡ æ”¹è¿›å»ºè®®:                                            â”‚
â”‚          å»ºè®®è¡¥å……:                                               â”‚
â”‚          1. æ˜ç¡®æ¯æœŸä»˜æ¬¾çš„å…·ä½“æ—¶é—´èŠ‚ç‚¹                            â”‚
â”‚          2. çº¦å®šé€¾æœŸä»˜æ¬¾çš„è¿çº¦é‡‘è®¡ç®—æ–¹å¼                          â”‚
â”‚          3. è®¾ç½®ä»˜æ¬¾å‰ææ¡ä»¶ï¼ˆå¦‚éªŒæ”¶åˆæ ¼åXæ—¥å†…ä»˜æ¬¾ï¼‰             â”‚
â”‚                                                                  â”‚
â”‚          è¿˜æœ‰å…¶ä»–æƒ³äº†è§£çš„å—ï¼Ÿå¦‚æœæ²¡æœ‰ï¼Œæˆ‘å¯ä»¥ä¸ºæ‚¨ç”Ÿæˆå®Œæ•´æŠ¥å‘Šã€‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   é˜¶æ®µ5: æŠ¥å‘Šç”Ÿæˆ (REPORTING - å¯é€‰)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  User: "ç”ŸæˆæŠ¥å‘Š"                                                â”‚
â”‚                                                                  â”‚
â”‚  Agent: "ğŸ“‹ å°†ä¸ºæ‚¨ç”Ÿæˆè¯„ä¼°æŠ¥å‘Šï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š                    â”‚
â”‚          âœ“ æ‰§è¡Œæ‘˜è¦                                               â”‚
â”‚          âœ“ é£é™©ç­‰çº§ä¸è¯„åˆ†                                         â”‚
â”‚          âœ“ è¯¦ç»†é£é™©åˆ†æï¼ˆä»˜æ¬¾æ¡æ¬¾ã€è¿çº¦è´£ä»»ã€äº‰è®®è§£å†³ç­‰ï¼‰         â”‚
â”‚          âœ“ æ”¹è¿›å»ºè®®æ¸…å•                                           â”‚
â”‚          âœ“ æ³•å¾‹æ¡æ–‡å‚è€ƒ                                           â”‚
â”‚                                                                  â”‚
â”‚          [ç”ŸæˆæŠ¥å‘Šä¸­...]                                          â”‚
â”‚                                                                  â”‚
â”‚          æŠ¥å‘Šå·²ç”Ÿæˆï¼æ‚¨å¯ä»¥ï¼š                                     â”‚
â”‚          ğŸ“¥ ä¸‹è½½PDFç‰ˆ                                            â”‚
â”‚          ğŸ‘€ æŸ¥çœ‹å®Œæ•´å†…å®¹                                          â”‚
â”‚          ğŸ”„ ç»§ç»­ä¿®æ”¹è¯„ä¼°æ¡ä»¶                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 çŠ¶æ€è½¬æ¢å›¾

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  INIT   â”‚  éœ€æ±‚ç¡®è®¤
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
              â”‚ ç¡®è®¤è¯„ä¼°ç±»å‹
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  COLLECTING     â”‚  ä¿¡æ¯æ”¶é›†
    â”‚  [å¯å¤šæ¬¡è¿­ä»£]    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ ä¿¡æ¯æ”¶é›†å®Œæˆ
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ANALYZING      â”‚  åˆæ­¥åˆ†æ
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ å±•ç¤ºæ¦‚è§ˆ
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  REVIEWING      â”‚  äº¤äº’æ·±å…¥
    â”‚  [å¯å¤šæ¬¡è¿­ä»£]    â”‚â—„â”€â”€â”€â”€â”€â”€â”
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ ç”¨æˆ·è¦æ±‚æ·±å…¥åˆ†æ
             â”‚                â”‚
             â”‚ ç”¨æˆ·æ»¡æ„        â”‚
             â†“                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
    â”‚ REPORTING       â”‚       â”‚
    â”‚ (å¯é€‰)          â”‚â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ç”¨æˆ·æ‰“æ–­æ”¯æŒ

ç”¨æˆ·å¯ä»¥åœ¨ä»»ä½•æ—¶å€™ï¼š
- ğŸ”„ **è·³è¿‡å½“å‰é—®é¢˜**ï¼šè·³è¿‡æŸé—®é¢˜ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ª
- â­ï¸ **ç›´æ¥è¿›å…¥æŠ¥å‘Š**ï¼šè·³è¿‡åç»­æµç¨‹ï¼Œç›´æ¥ç”ŸæˆæŠ¥å‘Š
- ğŸ”™ **è¿”å›ä¸Šä¸€æ­¥**ï¼šä¿®æ”¹ä¹‹å‰çš„å›ç­”
- â• **è¡¥å……ä¿¡æ¯**ï¼šä¸»åŠ¨æä¾›é¢å¤–ä¿¡æ¯

---

## 5. æç¤ºè¯å·¥ç¨‹

### 5.1 ç³»ç»Ÿæç¤ºè¯æ¨¡æ¿

```java
public class InteractiveAssessmentPrompts {

    public static final String SYSTEM_PROMPT = """
            ä½ æ˜¯ä¸€ä¸ªäº¤äº’å¼æ³•å¾‹é£é™©è¯„ä¼°ä¸“å®¶ï¼Œåä¸º"æ³•å¾‹åŠ©æ‰‹"ã€‚

            ## æ ¸å¿ƒåŸåˆ™
            1. **ç”¨æˆ·ä¸»å¯¼** - è®©ç”¨æˆ·å†³å®šè¯„ä¼°æ–¹å‘å’Œæ·±åº¦
            2. **æ¸è¿›å¼äº¤äº’** - åˆ†é˜¶æ®µæ”¶é›†ä¿¡æ¯ï¼Œé€æ­¥æ·±å…¥
            3. **ä¿¡æ¯åˆ†å±‚** - å…ˆç»™æ¦‚è§ˆï¼Œå†ç»™è¯¦æƒ…
            4. **å¯è§†åŒ–å‘ˆç°** - ä½¿ç”¨ç»“æ„åŒ–è¾“å‡ºï¼Œé¿å…å¤§æ®µæ–‡å­—
            5. **ä¸»åŠ¨å¼•å¯¼** - é€‚æ—¶è¯¢é—®ç”¨æˆ·éœ€æ±‚ï¼Œä¸è¦ç­‰ç”¨æˆ·æé—®

            ## è¯„ä¼°æµç¨‹ï¼ˆä¸¥æ ¼éµå¾ªï¼‰

            ### ã€é˜¶æ®µ1ã€‘éœ€æ±‚ç¡®è®¤ (INIT)
            ç›®æ ‡ï¼šäº†è§£ç”¨æˆ·æƒ³è¯„ä¼°ä»€ä¹ˆï¼Œå…³æ³¨å“ªäº›æ–¹é¢

            è¡ŒåŠ¨ï¼š
            - è¯¢é—®è¯„ä¼°ç±»å‹ï¼ˆåˆåŒ/åˆè§„/è¯‰è®¼ç­‰ï¼‰
            - äº†è§£ç”¨æˆ·å…³æ³¨çš„é‡ç‚¹é¢†åŸŸ
            - æ”¶é›†å¿…è¦çš„æ–‡æ¡£
            - äº†è§£æ—¶é—´ç´§è¿«æ€§

            è¾“å‡ºç¤ºä¾‹ï¼š
            "æ‚¨å¥½ï¼æˆ‘å¯ä»¥å¸®æ‚¨è¿›è¡Œæ³•å¾‹é£é™©è¯„ä¼°ã€‚
             è¯·é—®æ‚¨æƒ³è¯„ä¼°ä»€ä¹ˆï¼Ÿ
             1. åˆåŒé£é™©
             2. åˆè§„å®¡æŸ¥
             3. è¯‰è®¼é£é™©
             4. å…¶ä»–"

            ### ã€é˜¶æ®µ2ã€‘ä¿¡æ¯æ”¶é›† (COLLECTING)
            ç›®æ ‡ï¼šæ”¶é›†è¯„ä¼°æ‰€éœ€çš„å…³é”®ä¿¡æ¯

            è¡ŒåŠ¨ï¼š
            - å…ˆè°ƒç”¨ getFileContent å·¥å…·è¯»å–å·²ä¸Šä¼ çš„æ–‡æ¡£
            - æ ¹æ®æ–‡æ¡£å†…å®¹åŠ¨æ€ç”Ÿæˆåç»­é—®é¢˜
            - æ¯è½®åªé—® 2-3 ä¸ªé—®é¢˜
            - åŸºäºå·²æ”¶é›†ä¿¡æ¯è°ƒæ•´åç»­é—®é¢˜

            è¾“å‡ºç¤ºä¾‹ï¼š
            "æ”¶åˆ°æ–‡æ¡£ã€‚è®©æˆ‘å…ˆå¿«é€Ÿæµè§ˆä¸€ä¸‹...

             ä¸ºäº†æ›´å‡†ç¡®åœ°è¯„ä¼°ï¼Œæˆ‘è¿˜éœ€è¦äº†è§£ï¼š
             1. è¿™ä»½åˆåŒçš„äº¤æ˜“é‡‘é¢å¤§æ¦‚æ˜¯å¤šå°‘ï¼Ÿ
             2. æ‚¨åœ¨äº¤æ˜“ä¸­çš„è§’è‰²æ˜¯ä¹°æ–¹è¿˜æ˜¯å–æ–¹ï¼Ÿ"

            ### ã€é˜¶æ®µ3ã€‘åˆæ­¥åˆ†æ (ANALYZING)
            ç›®æ ‡ï¼šå¿«é€Ÿç»™å‡ºé£é™©æ¦‚è§ˆ

            è¡ŒåŠ¨ï¼š
            - åŸºäºæ”¶é›†çš„ä¿¡æ¯è¿›è¡Œå¿«é€Ÿè¯„ä¼°
            - ç»™å‡ºé£é™©ç­‰çº§å’Œè¯„åˆ†
            - åˆ—å‡º 3 ä¸ªå…³é”®å‘ç°
            - ä½¿ç”¨ emoji æ ‡è®°é£é™©ç¨‹åº¦

            é£é™©ç­‰çº§è¡¨ç¤ºï¼š
            ğŸš¨ é«˜é£é™© (70-100åˆ†)
            âš¡ ä¸­é£é™© (40-69åˆ†)
            âœ… ä½é£é™© (0-39åˆ†)

            è¾“å‡ºæ ¼å¼ï¼š
            "ğŸ“Š é£é™©å¿«é€Ÿè¯„ä¼°

             ğŸš¨ é£é™©ç­‰çº§: ä¸­ç­‰ (é£é™©è¯„åˆ†: 65/100)

             âš ï¸ å…³é”®å‘ç°:
             1. ä»˜æ¬¾æ¡æ¬¾å­˜åœ¨é£é™© - çº¦å®šåˆ†3æœŸä½†æœªæ˜ç¡®å…·ä½“æ—¥æœŸ
             2. è¿çº¦é‡‘æ¯”ä¾‹çº¦å®šä¸æ˜ç¡® - å¯èƒ½å¯¼è‡´è¿½è´£å›°éš¾
             3. äº‰è®®è§£å†³æ¡æ¬¾è¾ƒå®Œå–„ âœ…

             æ‚¨æƒ³æ·±å…¥äº†è§£å“ªä¸ªæ–¹é¢ï¼Ÿè¿˜æ˜¯ç»§ç»­è¯„ä¼°å…¶ä»–é£é™©ç‚¹ï¼Ÿ"

            ### ã€é˜¶æ®µ4ã€‘äº¤äº’æ·±å…¥ (REVIEWING)
            ç›®æ ‡ï¼šæ ¹æ®ç”¨æˆ·å…´è¶£æ·±å…¥åˆ†æç‰¹å®šæ–¹é¢

            è¡ŒåŠ¨ï¼š
            - é’ˆå¯¹ç”¨æˆ·é€‰æ‹©çš„æ–¹é¢è¿›è¡Œè¯¦ç»†åˆ†æ
            - å¼•ç”¨å…·ä½“æ¡æ¬¾å†…å®¹
            - è§£é‡Šé£é™©äº§ç”Ÿçš„åŸå› 
            - æä¾›å…·ä½“çš„æ”¹è¿›å»ºè®®
            - è¯¢é—®æ˜¯å¦éœ€è¦ç»§ç»­æ·±å…¥äº†è§£å…¶ä»–æ–¹é¢

            è¾“å‡ºæ ¼å¼ï¼š
            "ğŸ“„ [ä¸»é¢˜]è¯¦ç»†åˆ†æ

             ğŸ” å½“å‰çº¦å®š:
             ã€Œå¼•ç”¨å…·ä½“æ¡æ¬¾å†…å®¹ã€

             âš ï¸ é£é™©ç‚¹:
             â€¢ é£é™©ç‚¹1
             â€¢ é£é™©ç‚¹2
             â€¢ é£é™©ç‚¹3

             ğŸ’¡ æ”¹è¿›å»ºè®®:
             å»ºè®®è¡¥å……:
             1. å…·ä½“å»ºè®®1
             2. å…·ä½“å»ºè®®2

             è¿˜æœ‰å…¶ä»–æƒ³äº†è§£çš„å—ï¼Ÿ"

            ### ã€é˜¶æ®µ5ã€‘æŠ¥å‘Šç”Ÿæˆ (REPORTING)
            ç›®æ ‡ï¼šç”Ÿæˆå®Œæ•´è¯„ä¼°æŠ¥å‘Šï¼ˆä»…åœ¨ç”¨æˆ·æ˜ç¡®è¦æ±‚æ—¶ï¼‰

            è¡ŒåŠ¨ï¼š
            - å…ˆè¯´æ˜æŠ¥å‘Šå°†åŒ…å«çš„å†…å®¹
            - è¯¢é—®ç”¨æˆ·ç¡®è®¤
            - ç”Ÿæˆç»“æ„åŒ–æŠ¥å‘Š
            - æä¾›ä¸‹è½½é€‰é¡¹

            è¾“å‡ºæ ¼å¼ï¼š
            "ğŸ“‹ å°†ä¸ºæ‚¨ç”Ÿæˆè¯„ä¼°æŠ¥å‘Šï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
             âœ“ æ‰§è¡Œæ‘˜è¦
             âœ“ é£é™©ç­‰çº§ä¸è¯„åˆ†
             âœ“ è¯¦ç»†é£é™©åˆ†æ
             âœ“ æ”¹è¿›å»ºè®®æ¸…å•
             âœ“ æ³•å¾‹æ¡æ–‡å‚è€ƒ

             [ç”ŸæˆæŠ¥å‘Š...]

             æŠ¥å‘Šå·²ç”Ÿæˆï¼æ‚¨å¯ä»¥ï¼š
             ğŸ“¥ ä¸‹è½½PDFç‰ˆ
             ğŸ‘€ æŸ¥çœ‹å®Œæ•´å†…å®¹
             ğŸ”„ ç»§ç»­ä¿®æ”¹è¯„ä¼°æ¡ä»¶"

            ## è¾“å‡ºè§„èŒƒ

            ### æ ¼å¼è¦æ±‚
            - ä½¿ç”¨ emoji æå‡å¯è¯»æ€§
            - ä½¿ç”¨åˆ—è¡¨ã€åˆ†ç‚¹å±•ç¤º
            - æ¯ä¸ªæ®µè½ä¸è¶…è¿‡ 200 å­—
            - é‡è¦ä¿¡æ¯ç”¨ç²—ä½“æ ‡è®°
            - ä½¿ç”¨åˆ†éš”çº¿åŒºåˆ†ä¸åŒéƒ¨åˆ†

            ### é£é™©ç¨‹åº¦æ ‡è®°
            - ğŸš¨ é«˜é£é™© - éœ€è¦ç«‹å³å¤„ç†
            - âš¡ ä¸­é£é™© - å»ºè®®å°½å¿«å¤„ç†
            - âœ… æ­£å¸¸ - é£é™©å¯æ§
            - â„¹ï¸ æç¤º - ä¸€èˆ¬æ€§è¯´æ˜

            ### ç»“æ„æ ‡è®°
            - ğŸ“Š æ•°æ®/ç»Ÿè®¡
            - ğŸ“„ æ–‡æ¡£/æ¡æ¬¾
            - ğŸ” åˆ†æ/å‘ç°
            - ğŸ’¡ å»ºè®®/æç¤º
            - âš ï¸ è­¦å‘Š/æ³¨æ„
            - âœ“ å®Œæˆé¡¹
            - ğŸ“¥ ä¸‹è½½

            ## å¯ç”¨å·¥å…·

            1. **getFileContent(fileId)** - è·å–æ–‡ä»¶å†…å®¹
               ç”¨äºè¯»å–ç”¨æˆ·ä¸Šä¼ çš„æ–‡æ¡£

            2. **getCurrentTime(timezone)** - è·å–å½“å‰æ—¶é—´
               ç”¨äºç¡®è®¤è¯„ä¼°æ—¶é—´

            3. **searchKnowledge(query)** - æ£€ç´¢æ³•å¾‹çŸ¥è¯†
               ç”¨äºæŸ¥æ‰¾ç›¸å…³æ³•å¾‹æ¡æ–‡å’Œæ¡ˆä¾‹

            ## é‡è¦çº¦æŸ

            1. **ä¸è¦ä¸€æ¬¡æ€§è¾“å‡ºå®Œæ•´æŠ¥å‘Š** - é™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚
            2. **æ¯è½®å›å¤æ§åˆ¶åœ¨ 5 ä¸ªè¦ç‚¹ä»¥å†…** - é¿å…ä¿¡æ¯è¿‡è½½
            3. **ä¸»åŠ¨è¯¢é—®ç”¨æˆ·éœ€æ±‚** - ä¸è¦è‡ªé¡¾è‡ªåœ°åˆ†æ
            4. **ä½¿ç”¨ç”¨æˆ·èƒ½ç†è§£çš„è¯­è¨€** - é¿å…è¿‡å¤šæ³•å¾‹æœ¯è¯­
            5. **è®°ä½ç”¨æˆ·å·²æä¾›çš„ä¿¡æ¯** - ä¸è¦é‡å¤è¯¢é—®

            ## ç”¨æˆ·æ‰“æ–­å¤„ç†

            å½“ç”¨æˆ·è¯´ï¼š
            - "è·³è¿‡" â†’ è·³è¿‡å½“å‰é—®é¢˜ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥
            - "ç›´æ¥ç”ŸæˆæŠ¥å‘Š" â†’ è·³è¿‡åç»­æµç¨‹ï¼Œç”ŸæˆæŠ¥å‘Š
            - "è¿”å›" â†’ è¿”å›ä¸Šä¸€æ­¥
            - "è¡¥å……XXX" â†’ è®°å½•è¡¥å……ä¿¡æ¯

            ## ç¤ºä¾‹å¯¹è¯

            User: "æˆ‘æƒ³è¯„ä¼°è¿™ä»½åˆåŒçš„é£é™©"
            Assistant: "å¥½çš„ï¼Œè¯·ä¸Šä¼ åˆåŒæ–‡æ¡£ã€‚æ‚¨æœ€å…³å¿ƒåˆåŒçš„å“ªäº›æ–¹é¢ï¼Ÿ
                      ã€ä»˜æ¬¾æ¡æ¬¾ã€‘ã€è¿çº¦è´£ä»»ã€‘ã€äº‰è®®è§£å†³ã€‘ã€å…¶ä»–ã€‘"

            User: "ä»˜æ¬¾æ¡æ¬¾å’Œè¿çº¦è´£ä»»ï¼Œ[ä¸Šä¼ æ–‡ä»¶]"
            Assistant: "æ”¶åˆ°ã€‚è®©æˆ‘å…ˆçœ‹çœ‹åˆåŒå†…å®¹...
                      [è°ƒç”¨ getFileContent]

                      ä¸ºäº†æ›´å‡†ç¡®åœ°è¯„ä¼°ï¼Œæˆ‘è¿˜éœ€è¦äº†è§£ï¼š
                      1. è¿™ä»½åˆåŒçš„äº¤æ˜“é‡‘é¢å¤§æ¦‚æ˜¯å¤šå°‘ï¼Ÿ
                      2. æ‚¨åœ¨äº¤æ˜“ä¸­çš„è§’è‰²æ˜¯ä¹°æ–¹è¿˜æ˜¯å–æ–¹ï¼Ÿ"

            User: "é‡‘é¢50ä¸‡ï¼Œæˆ‘æ˜¯ä¹°æ–¹"
            Assistant: "æ˜ç™½äº†ã€‚è¿˜æœ‰å…¶ä»–éœ€è¦æˆ‘äº†è§£çš„å—ï¼Ÿ"
            """;

    public static final String RISK_ANALYSIS_PROMPT = """
            ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ³•å¾‹é£é™©åˆ†æä¸“å®¶ã€‚

            ## åˆ†ææ¡†æ¶

            ### 1. åˆåŒé£é™©åˆ†æç»´åº¦

            **(1) ä¸»ä½“èµ„æ ¼é£é™©**
            - å½“äº‹äººæ˜¯å¦å…·æœ‰æ°‘äº‹è¡Œä¸ºèƒ½åŠ›
            - æ˜¯å¦å­˜åœ¨ä»£ç†æƒé™é—®é¢˜
            - ç‰¹æ®Šè¡Œä¸šæ˜¯å¦å…·å¤‡ç›¸åº”èµ„è´¨

            **(2) å†…å®¹åˆæ³•æ€§é£é™©**
            - æ˜¯å¦è¿åæ³•å¾‹å¼ºåˆ¶æ€§è§„å®š
            - æ˜¯å¦æŸå®³ç¤¾ä¼šå…¬å…±åˆ©ç›Š
            - æ˜¯å¦å±äºæ— æ•ˆåˆåŒæƒ…å½¢

            **(3) æ¡æ¬¾å®Œå¤‡æ€§é£é™©**
            - æ ‡çš„ç‰©æ˜¯å¦æ˜ç¡®
            - æ•°é‡ã€è´¨é‡æ˜¯å¦çº¦å®šæ¸…æ¥š
            - å±¥è¡ŒæœŸé™ã€åœ°ç‚¹ã€æ–¹å¼æ˜¯å¦æ˜ç¡®
            - è¿çº¦è´£ä»»æ˜¯å¦æ˜ç¡®
            - äº‰è®®è§£å†³æ–¹å¼æ˜¯å¦çº¦å®š

            **(4) æƒåˆ©ä¹‰åŠ¡å¹³è¡¡æ€§**
            - æƒåˆ©ä¹‰åŠ¡æ˜¯å¦å¯¹ç­‰
            - æ˜¯å¦å­˜åœ¨æ˜¾å¤±å…¬å¹³æ¡æ¬¾
            - é£é™©åˆ†é…æ˜¯å¦åˆç†

            **(5) å±¥è¡Œå¯è¡Œæ€§**
            - å±¥è¡Œæ¡ä»¶æ˜¯å¦å…·å¤‡
            - å±¥è¡ŒæœŸé™æ˜¯å¦åˆç†
            - å±¥è¡Œæ–¹å¼æ˜¯å¦å¯æ“ä½œ

            ### 2. é£é™©ç­‰çº§è¯„å®šæ ‡å‡†

            **é«˜é£é™© (70-100åˆ†)**
            - å¯èƒ½å¯¼è‡´åˆåŒæ— æ•ˆ
            - å¯èƒ½é€ æˆé‡å¤§ç»æµæŸå¤±
            - å­˜åœ¨æ³•å¾‹ç¦æ­¢æ€§è§„å®š
            - ä¸¥é‡å½±å“åˆåŒå±¥è¡Œ

            **ä¸­é£é™© (40-69åˆ†)**
            - æ¡æ¬¾çº¦å®šä¸æ˜ç¡®
            - æƒåˆ©ä¹‰åŠ¡ä¸å¹³è¡¡
            - å­˜åœ¨æ½œåœ¨å±¥è¡Œéšœç¢
            - å¯èƒ½å¼•å‘äº‰è®®

            **ä½é£é™© (0-39åˆ†)**
            - æ–‡å­—è¡¨è¿°ç‘•ç–µ
            - éå…³é”®æ¡æ¬¾ç¼ºå¤±
            - å»ºè®®æ€§æ”¹è¿›ç‚¹

            ### 3. é£é™©è¯„åˆ†æ–¹æ³•

            æ€»åˆ† = å„ç»´åº¦æœ€é«˜åˆ† Ã— 0.6 + é£é™©æ•°é‡ç³»æ•° Ã— 0.4

            å„ç»´åº¦è¯„åˆ†ï¼š
            - ä¸»ä½“èµ„æ ¼ï¼š0-20åˆ†
            - å†…å®¹åˆæ³•æ€§ï¼š0-30åˆ†
            - æ¡æ¬¾å®Œå¤‡æ€§ï¼š0-25åˆ†
            - æƒåˆ©ä¹‰åŠ¡å¹³è¡¡ï¼š0-15åˆ†
            - å±¥è¡Œå¯è¡Œæ€§ï¼š0-10åˆ†

            é£é™©æ•°é‡ç³»æ•°ï¼š
            - é«˜é£é™© Ã— 1.5
            - ä¸­é£é™© Ã— 1.0
            - ä½é£é™© Ã— 0.5

            ## è¾“å‡ºæ ¼å¼

            é’ˆå¯¹ç”¨æˆ·æŒ‡å®šçš„åˆ†ææ–¹é¢ï¼Œæä¾›ï¼š

            ### ğŸ” å½“å‰çº¦å®š
            [å¼•ç”¨åˆåŒä¸­çš„å…·ä½“æ¡æ¬¾]

            ### âš ï¸ é£é™©ç‚¹
            â€¢ [å…·ä½“é£é™©1] - [å¯èƒ½å¯¼è‡´çš„åæœ]
            â€¢ [å…·ä½“é£é™©2] - [å¯èƒ½å¯¼è‡´çš„åæœ]

            ### ğŸ’¡ æ”¹è¿›å»ºè®®
            1. [å…·ä½“å»ºè®®1]
            2. [å…·ä½“å»ºè®®2]
            3. [å…·ä½“å»ºè®®3]

            ### ğŸ“š æ³•å¾‹ä¾æ®
            - [ç›¸å…³æ³•å¾‹æ¡æ–‡]
            - [å¸æ³•è§£é‡Š]
            - [å‚è€ƒæ¡ˆä¾‹]
            """;
}
```

### 5.2 é˜¶æ®µæç¤ºè¯

```java
public class StagePrompts {

    // é˜¶æ®µ1: éœ€æ±‚ç¡®è®¤
    public static final String INIT_STAGE = """
            ## å½“å‰é˜¶æ®µï¼šéœ€æ±‚ç¡®è®¤

            è¯·å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š
            1. äº†è§£ç”¨æˆ·çš„è¯„ä¼°éœ€æ±‚
            2. ç¡®è®¤è¯„ä¼°ç±»å‹
            3. è¯¢é—®ç”¨æˆ·å…³æ³¨çš„é‡ç‚¹
            4. æ”¶é›†å¿…è¦çš„æ–‡æ¡£

            æ¸©é¦¨æç¤ºï¼š
            - ä½¿ç”¨å‹å¥½çš„å¼€åœºç™½
            - æä¾›æ¸…æ™°çš„é€‰é¡¹
            - ä¸è¦ä¸€æ¬¡æ€§é—®å¤ªå¤šé—®é¢˜
            """;

    // é˜¶æ®µ2: ä¿¡æ¯æ”¶é›†
    public static final String COLLECTING_STAGE = """
            ## å½“å‰é˜¶æ®µï¼šä¿¡æ¯æ”¶é›†

            è¯·å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š
            1. ä½¿ç”¨ getFileContent å·¥å…·è¯»å–æ–‡æ¡£
            2. åˆ†ææ–‡æ¡£å†…å®¹ï¼Œè¯†åˆ«å…³é”®ä¿¡æ¯
            3. æ ¹æ®æ–‡æ¡£å†…å®¹ç”Ÿæˆé’ˆå¯¹æ€§é—®é¢˜
            4. æ¯è½®åªé—® 2-3 ä¸ªé—®é¢˜

            æ³¨æ„äº‹é¡¹ï¼š
            - åŸºäºå·²æœ‰ä¿¡æ¯ç”Ÿæˆé—®é¢˜
            - é¿å…é‡å¤è¯¢é—®
            - é—®é¢˜è¦å…·ä½“ã€å¯å›ç­”
            """;

    // é˜¶æ®µ3: åˆæ­¥åˆ†æ
    public static final String ANALYZING_STAGE = """
            ## å½“å‰é˜¶æ®µï¼šåˆæ­¥åˆ†æ

            è¯·å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š
            1. ç»¼åˆæ‰€æœ‰æ”¶é›†çš„ä¿¡æ¯
            2. è¿›è¡Œé£é™©ç­‰çº§è¯„å®š
            3. åˆ—å‡º 3 ä¸ªå…³é”®å‘ç°
            4. ä½¿ç”¨ emoji æ ‡è®°é£é™©ç¨‹åº¦

            è¾“å‡ºæ ¼å¼ï¼š
            ğŸ“Š é£é™©å¿«é€Ÿè¯„ä¼°
            ğŸš¨ é£é™©ç­‰çº§: [ç­‰çº§] (è¯„åˆ†: XX/100)
            âš ï¸ å…³é”®å‘ç°: [3æ¡]

            ç„¶åè¯¢é—®ï¼šæ‚¨æƒ³æ·±å…¥äº†è§£å“ªä¸ªæ–¹é¢ï¼Ÿ
            """;

    // é˜¶æ®µ4: äº¤äº’æ·±å…¥
    public static final String REVIEWING_STAGE = """
            ## å½“å‰é˜¶æ®µï¼šäº¤äº’æ·±å…¥

            è¯·å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š
            1. é’ˆå¯¹ç”¨æˆ·é€‰æ‹©çš„æ–¹é¢è¯¦ç»†åˆ†æ
            2. å¼•ç”¨å…·ä½“æ¡æ¬¾
            3. è§£é‡Šé£é™©åŸå› 
            4. æä¾›æ”¹è¿›å»ºè®®

            è¾“å‡ºæ ¼å¼ï¼š
            ğŸ“„ [ä¸»é¢˜]è¯¦ç»†åˆ†æ
            ğŸ” å½“å‰çº¦å®š
            âš ï¸ é£é™©ç‚¹
            ğŸ’¡ æ”¹è¿›å»ºè®®

            æœ€åè¯¢é—®ï¼šè¿˜æœ‰å…¶ä»–æƒ³äº†è§£çš„å—ï¼Ÿ
            """;

    // é˜¶æ®µ5: æŠ¥å‘Šç”Ÿæˆ
    public static final String REPORTING_STAGE = """
            ## å½“å‰é˜¶æ®µï¼šæŠ¥å‘Šç”Ÿæˆ

            è¯·å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š
            1. è¯´æ˜æŠ¥å‘Šå°†åŒ…å«çš„å†…å®¹
            2. ç”Ÿæˆç»“æ„åŒ–æŠ¥å‘Š
            3. æä¾›ä¸‹è½½é€‰é¡¹

            æŠ¥å‘Šç»“æ„ï¼š
            1. æ‰§è¡Œæ‘˜è¦
            2. é£é™©ç­‰çº§ä¸è¯„åˆ†
            3. è¯¦ç»†é£é™©åˆ†æ
            4. æ”¹è¿›å»ºè®®æ¸…å•
            5. æ³•å¾‹æ¡æ–‡å‚è€ƒ
            """;
}
```

---

## 6. åç«¯å®ç°

### 6.1 é¡¹ç›®ç»“æ„

```
src/main/java/com/legal/assistant/
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ base/
â”‚   â”‚   â””â”€â”€ ReactLegalAgent.java                 # AgentåŸºç±»
â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â”œâ”€â”€ FileToolService.java                 # æ–‡ä»¶å·¥å…·
â”‚   â”‚   â”œâ”€â”€ DateToolService.java                 # æ—¶é—´å·¥å…·
â”‚   â”‚   â””â”€â”€ RiskAssessmentToolService.java       # é£é™©è¯„ä¼°å·¥å…·ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ impl/
â”‚       â””â”€â”€ InteractiveRiskAssessmentAgent.java  # äº¤äº’å¼é£é™©è¯„ä¼°Agentï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ AssessmentController.java                # è¯„ä¼°APIï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ AssessmentService.java                   # è¯„ä¼°æœåŠ¡ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ AssessmentSessionService.java            # ä¼šè¯æœåŠ¡ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ AssessmentSession.java                   # ä¼šè¯å®ä½“ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ AssessmentReport.java                    # æŠ¥å‘Šå®ä½“ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ request/
â”‚   â”‚   â”œâ”€â”€ StartAssessmentRequest.java          # å¼€å§‹è¯„ä¼°è¯·æ±‚ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â””â”€â”€ SubmitInfoRequest.java               # æäº¤ä¿¡æ¯è¯·æ±‚ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ response/
â”‚       â”œâ”€â”€ AssessmentResponse.java              # è¯„ä¼°å“åº”ï¼ˆæ–°å¢ï¼‰
â”‚       â””â”€â”€ ReportResponse.java                  # æŠ¥å‘Šå“åº”ï¼ˆæ–°å¢ï¼‰
â””â”€â”€ mapper/
    â”œâ”€â”€ AssessmentSessionMapper.java             # ä¼šè¯Mapperï¼ˆæ–°å¢ï¼‰
    â””â”€â”€ AssessmentReportMapper.java              # æŠ¥å‘ŠMapperï¼ˆæ–°å¢ï¼‰
```

### 6.2 æ ¸å¿ƒä»£ç å®ç°

#### 6.2.1 RiskAssessmentToolService

```java
package com.legal.assistant.agents.tools;

import com.legal.assistant.entity.DocumentFile;
import com.legal.assistant.mapper.DocumentFileMapper;
import io.agentscope.core.tool.Tool;
import io.agentscope.core.tool.ToolParam;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import java.util.HashMap;
import java.util.Map;

/**
 * é£é™©è¯„ä¼°å·¥å…·æœåŠ¡
 */
@Slf4j
@Component
public class RiskAssessmentToolService {

    @Autowired
    private DocumentFileMapper documentFileMapper;

    @Tool(name = "analyzeDocumentRisk",
          description = "åˆ†ææ–‡æ¡£çš„æ³•å¾‹é£é™©ï¼Œè¿”å›é£é™©ç­‰çº§å’Œå…³é”®å‘ç°")
    public String analyzeDocumentRisk(
            @ToolParam(name = "fileId", description = "æ–‡ä»¶ID") Long fileId,
            @ToolParam(name = "assessmentType", description = "è¯„ä¼°ç±»å‹ï¼šåˆåŒé£é™©è¯„ä¼°/åˆè§„å®¡æŸ¥/è¯‰è®¼é£é™©åˆ†æ") String assessmentType,
            @ToolParam(name = "userFocus", description = "ç”¨æˆ·å…³æ³¨çš„é‡ç‚¹ï¼Œå¦‚ï¼šä»˜æ¬¾æ¡æ¬¾ã€è¿çº¦è´£ä»»ç­‰") String userFocus) {

        log.info("å¼€å§‹åˆ†ææ–‡æ¡£é£é™©: fileId={}, type={}, focus={}",
                fileId, assessmentType, userFocus);

        // 1. è·å–æ–‡æ¡£ä¿¡æ¯
        DocumentFile document = documentFileMapper.selectById(fileId);
        if (document == null) {
            return "é”™è¯¯: æ–‡æ¡£ä¸å­˜åœ¨ï¼Œæ–‡ä»¶ID: " + fileId;
        }

        // 2. è¿”å›åˆ†ææŒ‡ä»¤ï¼ˆç”±Agentæ‰§è¡Œå®é™…åˆ†æï¼‰
        Map<String, Object> analysisContext = new HashMap<>();
        analysisContext.put("fileId", fileId);
        analysisContext.put("fileName", document.getFileName());
        analysisContext.put("assessmentType", assessmentType);
        analysisContext.put("userFocus", userFocus);

        log.info("é£é™©åˆ†æä¸Šä¸‹æ–‡å·²å‡†å¤‡: {}", analysisContext);

        return String.format("""
                è¯·åˆ†ææ–‡æ¡£: %s
                è¯„ä¼°ç±»å‹: %s
                ç”¨æˆ·å…³æ³¨: %s

                è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤åˆ†æï¼š
                1. è¯†åˆ«æ–‡æ¡£ä¸­çš„å…³é”®æ¡æ¬¾
                2. è¯„ä¼°å„ç±»é£é™©
                3. ç»™å‡ºé£é™©ç­‰çº§
                4. åˆ—å‡º3ä¸ªå…³é”®å‘ç°
                """,
                document.getFileName(), assessmentType, userFocus);
    }

    @Tool(name = "generateRiskReport",
          description = "ç”Ÿæˆå®Œæ•´çš„æ³•å¾‹é£é™©è¯„ä¼°æŠ¥å‘Š")
    public String generateRiskReport(
            @ToolParam(name = "sessionId", description = "è¯„ä¼°ä¼šè¯ID") String sessionId,
            @ToolParam(name = "includeDetails", description = "æ˜¯å¦åŒ…å«è¯¦ç»†åˆ†æ") boolean includeDetails,
            @ToolParam(name = "includeLegalReferences", description = "æ˜¯å¦åŒ…å«æ³•å¾‹æ¡æ–‡å‚è€ƒ") boolean includeLegalReferences) {

        log.info("ç”Ÿæˆé£é™©è¯„ä¼°æŠ¥å‘Š: sessionId={}, details={}, legalRefs={}",
                sessionId, includeDetails, includeLegalReferences);

        return """
                ## æŠ¥å‘Šç”Ÿæˆå‚æ•°ç¡®è®¤

                ä¼šè¯ID: %s
                åŒ…å«è¯¦ç»†åˆ†æ: %s
                åŒ…å«æ³•å¾‹å‚è€ƒ: %s

                è¯·æŒ‰ç…§ä»¥ä¸‹ç»“æ„ç”ŸæˆæŠ¥å‘Šï¼š
                1. æ‰§è¡Œæ‘˜è¦
                2. é£é™©ç­‰çº§ä¸è¯„åˆ†
                3. è¯¦ç»†é£é™©åˆ†æ
                4. æ”¹è¿›å»ºè®®æ¸…å•
                5. æ³•å¾‹æ¡æ–‡å‚è€ƒï¼ˆå¦‚æœå¯ç”¨ï¼‰
                """.formatted(sessionId, includeDetails, includeLegalReferences);
    }

    @Tool(name = "searchLegalKnowledge",
          description = "æœç´¢ç›¸å…³çš„æ³•å¾‹çŸ¥è¯†å’Œæ¡ˆä¾‹")
    public String searchLegalKnowledge(
            @ToolParam(name = "query", description = "æœç´¢æŸ¥è¯¢ï¼Œå¦‚ï¼šåˆåŒè¿çº¦è´£ä»»ç›¸å…³æ³•å¾‹") String query) {

        log.info("æœç´¢æ³•å¾‹çŸ¥è¯†: query={}", query);

        // TODO: å®ç°å‘é‡æ£€ç´¢æˆ–è°ƒç”¨å¤–éƒ¨API
        return """
                æœç´¢å…³é”®è¯: %s

                ç›¸å…³æ³•å¾‹çŸ¥è¯†ï¼š
                - ã€Šä¸­åäººæ°‘å…±å’Œå›½æ°‘æ³•å…¸ã€‹ç¬¬577æ¡ï¼šå½“äº‹äººä¸€æ–¹ä¸å±¥è¡ŒåˆåŒä¹‰åŠ¡æˆ–è€…å±¥è¡ŒåˆåŒä¹‰åŠ¡ä¸ç¬¦åˆçº¦å®šçš„ï¼Œåº”å½“æ‰¿æ‹…ç»§ç»­å±¥è¡Œã€é‡‡å–è¡¥æ•‘æªæ–½æˆ–è€…èµ”å¿æŸå¤±ç­‰è¿çº¦è´£ä»»ã€‚
                - ã€Šä¸­åäººæ°‘å…±å’Œå›½æ°‘æ³•å…¸ã€‹ç¬¬585æ¡ï¼šå½“äº‹äººå¯ä»¥çº¦å®šä¸€æ–¹è¿çº¦æ—¶åº”å½“æ ¹æ®è¿çº¦æƒ…å†µå‘å¯¹æ–¹æ”¯ä»˜ä¸€å®šæ•°é¢çš„è¿çº¦é‡‘...

                ï¼ˆæç¤ºï¼šå®é™…ä½¿ç”¨æ—¶åº”è¯¥è°ƒç”¨Milvuså‘é‡æ£€ç´¢è·å–ç›¸å…³çŸ¥è¯†ï¼‰
                """.formatted(query);
    }
}
```

#### 6.2.2 InteractiveRiskAssessmentAgent

```java
package com.legal.assistant.agents.impl;

import com.legal.assistant.agents.base.ReactLegalAgent;
import com.legal.assistant.agents.tools.DateToolService;
import com.legal.assistant.agents.tools.FileToolService;
import com.legal.assistant.agents.tools.RiskAssessmentToolService;
import com.legal.assistant.enums.AgentType;
import com.legal.assistant.enums.ModelType;
import io.agentscope.core.ReActAgent;
import io.agentscope.core.model.DashScopeChatModel;
import io.agentscope.core.tool.Toolkit;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;

/**
 * äº¤äº’å¼é£é™©è¯„ä¼°Agent
 */
public class InteractiveRiskAssessmentAgent extends ReactLegalAgent {

    @Autowired(required = false)
    private FileToolService fileToolService;

    @Autowired(required = false)
    private DateToolService dateToolService;

    @Autowired(required = false)
    private RiskAssessmentToolService riskAssessmentToolService;

    @Value("${agent.risk-assessment.max-iterations:10}")
    private int maxIterations;

    @Value("${agent.risk-assessment.temperature:0.7}")
    private double temperature;

    @Override
    public AgentType getAgentType() {
        return AgentType.RISK_ASSESSMENT;
    }

    @Override
    public String getSystemPrompt() {
        return """
                ä½ æ˜¯ä¸€ä¸ªäº¤äº’å¼æ³•å¾‹é£é™©è¯„ä¼°ä¸“å®¶ï¼Œåä¸º"æ³•å¾‹åŠ©æ‰‹"ã€‚

                ## æ ¸å¿ƒåŸåˆ™
                1. **ç”¨æˆ·ä¸»å¯¼** - è®©ç”¨æˆ·å†³å®šè¯„ä¼°æ–¹å‘å’Œæ·±åº¦
                2. **æ¸è¿›å¼äº¤äº’** - åˆ†é˜¶æ®µæ”¶é›†ä¿¡æ¯ï¼Œé€æ­¥æ·±å…¥
                3. **ä¿¡æ¯åˆ†å±‚** - å…ˆç»™æ¦‚è§ˆï¼Œå†ç»™è¯¦æƒ…
                4. **å¯è§†åŒ–å‘ˆç°** - ä½¿ç”¨ç»“æ„åŒ–è¾“å‡ºï¼Œé¿å…å¤§æ®µæ–‡å­—
                5. **ä¸»åŠ¨å¼•å¯¼** - é€‚æ—¶è¯¢é—®ç”¨æˆ·éœ€æ±‚ï¼Œä¸è¦ç­‰ç”¨æˆ·æé—®

                ## è¯„ä¼°æµç¨‹ï¼ˆ5ä¸ªé˜¶æ®µï¼‰

                ### ã€é˜¶æ®µ1ã€‘éœ€æ±‚ç¡®è®¤
                - è¯¢é—®è¯„ä¼°ç±»å‹ï¼ˆåˆåŒ/åˆè§„/è¯‰è®¼ç­‰ï¼‰
                - äº†è§£ç”¨æˆ·å…³æ³¨çš„é‡ç‚¹é¢†åŸŸ
                - æ”¶é›†å¿…è¦çš„æ–‡æ¡£

                ### ã€é˜¶æ®µ2ã€‘ä¿¡æ¯æ”¶é›†
                - ä½¿ç”¨ getFileContent å·¥å…·è¯»å–æ–‡æ¡£
                - æ ¹æ®æ–‡æ¡£å†…å®¹åŠ¨æ€ç”Ÿæˆåç»­é—®é¢˜
                - æ¯è½®åªé—® 2-3 ä¸ªé—®é¢˜

                ### ã€é˜¶æ®µ3ã€‘åˆæ­¥åˆ†æ
                - ç»™å‡ºé£é™©ç­‰çº§å’Œè¯„åˆ†
                - åˆ—å‡º 3 ä¸ªå…³é”®å‘ç°
                - ä½¿ç”¨ emoji æ ‡è®°é£é™©ç¨‹åº¦

                ### ã€é˜¶æ®µ4ã€‘äº¤äº’æ·±å…¥
                - é’ˆå¯¹ç”¨æˆ·é€‰æ‹©çš„æ–¹é¢è¯¦ç»†åˆ†æ
                - å¼•ç”¨å…·ä½“æ¡æ¬¾
                - æä¾›æ”¹è¿›å»ºè®®

                ### ã€é˜¶æ®µ5ã€‘æŠ¥å‘Šç”Ÿæˆ
                - ä»…åœ¨ç”¨æˆ·æ˜ç¡®è¦æ±‚æ—¶ç”Ÿæˆ
                - è¯´æ˜æŠ¥å‘Šå°†åŒ…å«çš„å†…å®¹
                - æä¾›ä¸‹è½½é€‰é¡¹

                ## é£é™©ç­‰çº§è¡¨ç¤º
                ğŸš¨ é«˜é£é™© (70-100åˆ†)
                âš¡ ä¸­é£é™© (40-69åˆ†)
                âœ… ä½é£é™© (0-39åˆ†)

                ## å¯ç”¨å·¥å…·
                1. getFileContent(fileId) - è·å–æ–‡ä»¶å†…å®¹
                2. analyzeDocumentRisk(fileId, type, focus) - åˆ†ææ–‡æ¡£é£é™©
                3. generateRiskReport(sessionId, includeDetails, includeLegalRefs) - ç”ŸæˆæŠ¥å‘Š
                4. searchLegalKnowledge(query) - æœç´¢æ³•å¾‹çŸ¥è¯†
                5. getCurrentTime(timezone) - è·å–å½“å‰æ—¶é—´

                ## é‡è¦çº¦æŸ
                1. **ä¸è¦ä¸€æ¬¡æ€§è¾“å‡ºå®Œæ•´æŠ¥å‘Š** - é™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚
                2. **æ¯è½®å›å¤æ§åˆ¶åœ¨ 5 ä¸ªè¦ç‚¹ä»¥å†…**
                3. **ä¸»åŠ¨è¯¢é—®ç”¨æˆ·éœ€æ±‚** - ä¸è¦è‡ªé¡¾è‡ªåœ°åˆ†æ
                4. **è®°ä½ç”¨æˆ·å·²æä¾›çš„ä¿¡æ¯** - ä¸è¦é‡å¤è¯¢é—®
                """;
    }

    @Override
    public ReActAgent configure(ModelType modelType, Double temperature) {
        String modelName = modelType.getCode();

        DashScopeChatModel model = DashScopeChatModel.builder()
                .apiKey(apiKey)
                .modelName(modelName)
                .temperature(temperature != null ? temperature : this.temperature)
                .build();

        // åˆ›å»ºå·¥å…·é›†å¹¶æ³¨å†Œæ‰€æœ‰å·¥å…·
        Toolkit toolkit = new Toolkit();
        if (fileToolService != null) {
            toolkit.registerTool(fileToolService);
        }
        if (dateToolService != null) {
            toolkit.registerTool(dateToolService);
        }
        if (riskAssessmentToolService != null) {
            toolkit.registerTool(riskAssessmentToolService);
        }

        return ReActAgent.builder()
                .name(getAgentType().getCode())
                .sysPrompt(getSystemPrompt())
                .model(model)
                .maxIters(maxIterations)
                .toolkit(toolkit)
                .build();
    }
}
```

#### 6.2.3 AssessmentService

```java
package com.legal.assistant.service;

import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.legal.assistant.agents.impl.InteractiveRiskAssessmentAgent;
import com.legal.assistant.dto.request.StartAssessmentRequest;
import com.legal.assistant.dto.response.AssessmentResponse;
import com.legal.assistant.entity.AssessmentSession;
import com.legal.assistant.enums.AgentType;
import com.legal.assistant.enums.ModelType;
import com.legal.assistant.mapper.AssessmentSessionMapper;
import io.agentscope.core.message.Msg;
import io.agentscope.core.message.MsgRole;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.UUID;

/**
 * é£é™©è¯„ä¼°æœåŠ¡
 */
@Slf4j
@Service
public class AssessmentService {

    @Autowired
    private InteractiveRiskAssessmentAgent agent;

    @Autowired
    private AssessmentSessionMapper sessionMapper;

    @Autowired
    private AssessmentSessionService sessionService;

    private final ObjectMapper objectMapper = new ObjectMapper();

    /**
     * å¼€å§‹æ–°çš„è¯„ä¼°
     */
    public AssessmentResponse startAssessment(StartAssessmentRequest request) {
        try {
            // 1. åˆ›å»ºè¯„ä¼°ä¼šè¯
            String sessionId = UUID.randomUUID().toString();
            AssessmentSession session = new AssessmentSession();
            session.setSessionId(sessionId);
            session.setChatId(request.getChatId());
            session.setUserId(request.getUserId());
            session.setCurrentStage("INIT");
            session.setAssessmentType(request.getAssessmentType());
            session.setStatus("ACTIVE");
            session.setCreatedAt(LocalDateTime.now());

            sessionMapper.insert(session);

            log.info("åˆ›å»ºè¯„ä¼°ä¼šè¯: sessionId={}, userId={}, type={}",
                    sessionId, request.getUserId(), request.getAssessmentType());

            // 2. åˆå§‹åŒ–Agentå¹¶å‘é€åˆå§‹æ¶ˆæ¯
            var reactAgent = agent.configure(ModelType.QWEN_MAX, agent.getDefaultTemperature());

            String userMessage = String.format(
                    "æˆ‘æƒ³è¿›è¡Œ%sï¼Œè¿™æ˜¯æˆ‘çš„éœ€æ±‚ï¼š%s",
                    request.getAssessmentType(),
                    request.getUserMessage()
            );

            Msg msg = Msg.builder()
                    .role(MsgRole.USER)
                    .textContent(userMessage)
                    .build();

            // 3. è°ƒç”¨Agentè·å–å“åº”
            Msg response = reactAgent.call(msg).block();

            // 4. æ›´æ–°ä¼šè¯çŠ¶æ€
            session.setCurrentStage("COLLECTING");
            session.setUpdatedAt(LocalDateTime.now());
            sessionMapper.updateById(session);

            // 5. ä¿å­˜ä¼šè¯ä¸Šä¸‹æ–‡
            sessionService.updateContext(sessionId, "lastMessage", userMessage);
            sessionService.updateContext(sessionId, "agentResponse", response.getTextContent());

            // 6. æ„é€ å“åº”
            AssessmentResponse assessmentResponse = new AssessmentResponse();
            assessmentResponse.setSessionId(sessionId);
            assessmentResponse.setCurrentStage("COLLECTING");
            assessmentResponse.setAgentResponse(response.getTextContent());
            assessmentResponse.setSuggestions(new String[]{
                    "è¯·æŒ‰ç…§Agentçš„æŒ‡å¼•æä¾›ç›¸å…³ä¿¡æ¯",
                    "æ‚¨å¯ä»¥éšæ—¶è¯´\"è·³è¿‡\"æ¥è·³è¿‡æŸä¸ªé—®é¢˜",
                    "è¯´\"ç”ŸæˆæŠ¥å‘Š\"å¯ä»¥ç›´æ¥ç”Ÿæˆè¯„ä¼°æŠ¥å‘Š"
            });

            return assessmentResponse;

        } catch (Exception e) {
            log.error("å¯åŠ¨è¯„ä¼°å¤±è´¥", e);
            throw new RuntimeException("å¯åŠ¨è¯„ä¼°å¤±è´¥: " + e.getMessage());
        }
    }

    /**
     * ç»§ç»­è¯„ä¼°å¯¹è¯
     */
    public AssessmentResponse continueAssessment(String sessionId, String userMessage) {
        try {
            // 1. è·å–ä¼šè¯
            AssessmentSession session = sessionMapper.selectOne(
                    LambdaQueryWrapper<AssessmentSession>()
                            .eq(AssessmentSession::getSessionId, sessionId)
            );

            if (session == null) {
                throw new RuntimeException("ä¼šè¯ä¸å­˜åœ¨: " + sessionId);
            }

            // 2. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦è¦æ±‚ç”ŸæˆæŠ¥å‘Š
            if (userMessage.contains("ç”ŸæˆæŠ¥å‘Š") || userMessage.contains("ç›´æ¥ç”Ÿæˆ")) {
                return generateReport(session);
            }

            // 3. è·å–Agentå®ä¾‹
            var reactAgent = agent.configure(ModelType.QWEN_MAX, agent.getDefaultTemperature());

            // 4. åŠ è½½ä¼šè¯å†å²
            // TODO: ä»sessionåŠ è½½å†å²æ¶ˆæ¯

            // 5. å‘é€ç”¨æˆ·æ¶ˆæ¯
            Msg msg = Msg.builder()
                    .role(MsgRole.USER)
                    .textContent(userMessage)
                    .build();

            Msg response = reactAgent.call(msg).block();

            // 6. æ›´æ–°ä¼šè¯ä¸Šä¸‹æ–‡
            sessionService.updateContext(sessionId, "lastUserMessage", userMessage);
            sessionService.updateContext(sessionId, "lastAgentResponse", response.getTextContent());
            session.setUpdatedAt(LocalDateTime.now());
            sessionMapper.updateById(session);

            // 7. æ„é€ å“åº”
            AssessmentResponse assessmentResponse = new AssessmentResponse();
            assessmentResponse.setSessionId(sessionId);
            assessmentResponse.setCurrentStage(session.getCurrentStage());
            assessmentResponse.setAgentResponse(response.getTextContent());

            return assessmentResponse;

        } catch (Exception e) {
            log.error("ç»§ç»­è¯„ä¼°å¤±è´¥: sessionId={}", sessionId, e);
            throw new RuntimeException("ç»§ç»­è¯„ä¼°å¤±è´¥: " + e.getMessage());
        }
    }

    /**
     * ç”Ÿæˆè¯„ä¼°æŠ¥å‘Š
     */
    private AssessmentResponse generateReport(AssessmentSession session) {
        log.info("ç”Ÿæˆè¯„ä¼°æŠ¥å‘Š: sessionId={}", session.getSessionId());

        // æ›´æ–°ä¼šè¯çŠ¶æ€
        session.setCurrentStage("REPORTING");
        session.setStatus("COMPLETED");
        session.setUpdatedAt(LocalDateTime.now());
        sessionMapper.updateById(session);

        AssessmentResponse response = new AssessmentResponse();
        response.setSessionId(session.getSessionId());
        response.setCurrentStage("REPORTING");
        response.setAgentResponse("æ­£åœ¨ç”Ÿæˆè¯„ä¼°æŠ¥å‘Š...");
        response.setReportGenerated(true);

        return response;
    }

    /**
     * è·å–ä¼šè¯çŠ¶æ€
     */
    public AssessmentSession getSessionStatus(String sessionId) {
        return sessionMapper.selectOne(
                LambdaQueryWrapper<AssessmentSession>()
                        .eq(AssessmentSession::getSessionId, sessionId)
        );
    }
}
```

#### 6.2.4 AssessmentController

```java
package com.legal.assistant.controller;

import com.legal.assistant.dto.request.StartAssessmentRequest;
import com.legal.assistant.dto.response.AssessmentResponse;
import com.legal.assistant.entity.AssessmentSession;
import com.legal.assistant.service.AssessmentService;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.*;

/**
 * é£é™©è¯„ä¼°API
 */
@Slf4j
@Tag(name = "é£é™©è¯„ä¼°", description = "äº¤äº’å¼é£é™©è¯„ä¼°ç›¸å…³æ¥å£")
@RestController
@RequestMapping("/api/assessment")
@RequiredArgsConstructor
public class AssessmentController {

    private final AssessmentService assessmentService;

    @Operation(summary = "å¼€å§‹æ–°çš„é£é™©è¯„ä¼°")
    @PostMapping("/start")
    public AssessmentResponse startAssessment(@RequestBody StartAssessmentRequest request) {
        log.info("å¼€å§‹é£é™©è¯„ä¼°: userId={}, type={}",
                request.getUserId(), request.getAssessmentType());
        return assessmentService.startAssessment(request);
    }

    @Operation(summary = "ç»§ç»­è¯„ä¼°å¯¹è¯")
    @PostMapping("/continue")
    public AssessmentResponse continueAssessment(
            @RequestParam String sessionId,
            @RequestParam String message) {
        log.info("ç»§ç»­è¯„ä¼°: sessionId={}", sessionId);
        return assessmentService.continueAssessment(sessionId, message);
    }

    @Operation(summary = "è·å–ä¼šè¯çŠ¶æ€")
    @GetMapping("/status/{sessionId}")
    public AssessmentSession getStatus(@PathVariable String sessionId) {
        return assessmentService.getSessionStatus(sessionId);
    }

    @Operation(summary = "ç»“æŸè¯„ä¼°")
    @PostMapping("/end/{sessionId}")
    public String endAssessment(@PathVariable String sessionId) {
        // TODO: å®ç°ç»“æŸè¯„ä¼°é€»è¾‘
        return "è¯„ä¼°å·²ç»“æŸ";
    }
}
```

---

## 7. å‰ç«¯å®ç°

### 7.1 é¡µé¢ç»„ä»¶è®¾è®¡

```
src/pages/assessment/
â”œâ”€â”€ Assessment.jsx                # ä¸»é¡µé¢
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ChatInterface.jsx         # èŠå¤©ç•Œé¢
â”‚   â”œâ”€â”€ RiskCard.jsx              # é£é™©å¡ç‰‡
â”‚   â”œâ”€â”€ ProgressBar.jsx           # è¿›åº¦æ¡
â”‚   â”œâ”€â”€ QuestionFlow.jsx          # é—®é¢˜æµç¨‹
â”‚   â””â”€â”€ ReportPreview.jsx         # æŠ¥å‘Šé¢„è§ˆ
â””â”€â”€ hooks/
    â”œâ”€â”€ useAssessment.js          # è¯„ä¼°çŠ¶æ€ç®¡ç†
    â””â”€â”€ useWebSocket.js           # å®æ—¶é€šä¿¡
```

### 7.2 æ ¸å¿ƒç»„ä»¶ä»£ç 

#### 7.2.1 Assessment.jsx

```jsx
import React, { useState, useEffect } from 'react';
import { useParams } from 'react-router-dom';
import ChatInterface from './components/ChatInterface';
import RiskCard from './components/RiskCard';
import ProgressBar from './components/ProgressBar';
import { useAssessment } from './hooks/useAssessment';
import './Assessment.css';

const Assessment = () => {
    const { sessionId } = useParams();
    const [stage, setStage] = useState('INIT');
    const [messages, setMessages] = useState([]);
    const [riskData, setRiskData] = useState(null);

    const {
        startAssessment,
        continueAssessment,
        isLoading,
        error
    } = useAssessment();

    useEffect(() => {
        // å¦‚æœæ˜¯æ–°ä¼šè¯ï¼Œå¼€å§‹è¯„ä¼°
        if (!sessionId) {
            handleStart();
        }
    }, []);

    const handleStart = async () => {
        const request = {
            userId: getCurrentUserId(),
            assessmentType: 'CONTRACT_RISK_ASSESSMENT',
            userMessage: 'æˆ‘æƒ³è¯„ä¼°åˆåŒé£é™©'
        };

        const response = await startAssessment(request);
        setMessages([
            { role: 'assistant', content: response.agentResponse }
        ]);
        setStage(response.currentStage);
    };

    const handleSendMessage = async (message) => {
        // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
        setMessages(prev => [...prev, { role: 'user', content: message }]);

        // å‘é€åˆ°åç«¯
        const response = await continueAssessment(sessionId, message);

        // æ·»åŠ åŠ©æ‰‹å“åº”
        setMessages(prev => [...prev, {
            role: 'assistant',
            content: response.agentResponse
        }]);

        setStage(response.currentStage);

        // å¦‚æœå“åº”åŒ…å«é£é™©æ•°æ®ï¼Œè§£æå¹¶æ˜¾ç¤º
        if (response.riskData) {
            setRiskData(response.riskData);
        }
    };

    const stages = [
        { key: 'INIT', label: 'éœ€æ±‚ç¡®è®¤', icon: 'ğŸ“‹' },
        { key: 'COLLECTING', label: 'ä¿¡æ¯æ”¶é›†ä¸­', icon: 'ğŸ”' },
        { key: 'ANALYZING', label: 'åˆ†æä¸­', icon: 'âš™ï¸' },
        { key: 'REVIEWING', label: 'æ·±å…¥åˆ†æ', icon: 'ğŸ”¬' },
        { key: 'REPORTING', label: 'æŠ¥å‘Šç”Ÿæˆ', icon: 'ğŸ“„' }
    ];

    const currentStageIndex = stages.findIndex(s => s.key === stage);

    return (
        <div className="assessment-container">
            {/* è¿›åº¦æ¡ */}
            <ProgressBar
                stages={stages}
                currentStage={currentStageIndex}
            />

            {/* ä¸»è¦å†…å®¹åŒº */}
            <div className="assessment-content">
                {/* èŠå¤©ç•Œé¢ */}
                <ChatInterface
                    messages={messages}
                    onSendMessage={handleSendMessage}
                    isLoading={isLoading}
                />

                {/* é£é™©å¡ç‰‡ï¼ˆå¦‚æœæœ‰é£é™©æ•°æ®ï¼‰ */}
                {riskData && (
                    <RiskCard data={riskData} />
                )}
            </div>
        </div>
    );
};

export default Assessment;
```

#### 7.2.2 ChatInterface.jsx

```jsx
import React, { useRef, useEffect } from 'react';
import ReactMarkdown from 'react-markdown';
import './ChatInterface.css';

const ChatInterface = ({ messages, onSendMessage, isLoading }) => {
    const messagesEndRef = useRef(null);
    const [inputValue, setInputValue] = useState('');

    const scrollToBottom = () => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
    };

    useEffect(() => {
        scrollToBottom();
    }, [messages]);

    const handleSubmit = (e) => {
        e.preventDefault();
        if (inputValue.trim() && !isLoading) {
            onSendMessage(inputValue);
            setInputValue('');
        }
    };

    const quickActions = [
        { label: 'è·³è¿‡è¿™ä¸ªé—®é¢˜', value: 'è·³è¿‡' },
        { label: 'ç›´æ¥ç”ŸæˆæŠ¥å‘Š', value: 'ç”ŸæˆæŠ¥å‘Š' },
        { label: 'è¿”å›ä¸Šä¸€æ­¥', value: 'è¿”å›' }
    ];

    return (
        <div className="chat-interface">
            {/* æ¶ˆæ¯åˆ—è¡¨ */}
            <div className="messages-container">
                {messages.map((message, index) => (
                    <div
                        key={index}
                        className={`message ${message.role === 'user' ? 'user-message' : 'assistant-message'}`}
                    >
                        {message.role === 'assistant' ? (
                            <ReactMarkdown>{message.content}</ReactMarkdown>
                        ) : (
                            <div className="message-content">{message.content}</div>
                        )}
                    </div>
                ))}

                {isLoading && (
                    <div className="message assistant-message">
                        <div className="typing-indicator">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                )}

                <div ref={messagesEndRef} />
            </div>

            {/* å¿«æ·æ“ä½œ */}
            <div className="quick-actions">
                {quickActions.map(action => (
                    <button
                        key={action.value}
                        className="quick-action-btn"
                        onClick={() => onSendMessage(action.value)}
                        disabled={isLoading}
                    >
                        {action.label}
                    </button>
                ))}
            </div>

            {/* è¾“å…¥æ¡† */}
            <form className="message-input-form" onSubmit={handleSubmit}>
                <input
                    type="text"
                    className="message-input"
                    placeholder="è¾“å…¥æ‚¨çš„å›å¤..."
                    value={inputValue}
                    onChange={(e) => setInputValue(e.target.value)}
                    disabled={isLoading}
                />
                <button
                    type="submit"
                    className="send-button"
                    disabled={isLoading || !inputValue.trim()}
                >
                    å‘é€
                </button>
            </form>
        </div>
    );
};

export default ChatInterface;
```

#### 7.2.3 RiskCard.jsx

```jsx
import React from 'react';
import './RiskCard.css';

const RiskCard = ({ data }) => {
    const getRiskLevel = (score) => {
        if (score >= 70) return { level: 'é«˜', color: '#ff4444', emoji: 'ğŸš¨' };
        if (score >= 40) return { level: 'ä¸­', color: '#ffbb33', emoji: 'âš¡' };
        return { level: 'ä½', color: '#00C851', emoji: 'âœ…' };
    };

    const riskInfo = getRiskLevel(data.score);

    return (
        <div className="risk-card">
            <div className="risk-header" style={{ borderColor: riskInfo.color }}>
                <h3>ğŸ“Š é£é™©è¯„ä¼°ç»“æœ</h3>
                <div className="risk-badge" style={{ backgroundColor: riskInfo.color }}>
                    {riskInfo.emoji} {riskInfo.level}é£é™©
                </div>
            </div>

            <div className="risk-score">
                <div className="score-circle">
                    <span className="score-value">{data.score}</span>
                    <span className="score-total">/100</span>
                </div>
            </div>

            <div className="risk-findings">
                <h4>âš ï¸ å…³é”®å‘ç°</h4>
                <ul>
                    {data.findings.map((finding, index) => (
                        <li key={index}>{finding}</li>
                    ))}
                </ul>
            </div>

            <div className="risk-categories">
                <h4>ğŸ“‹ é£é™©åˆ†ç±»</h4>
                {data.categories.map((category, index) => (
                    <div key={index} className="risk-category-item">
                        <span className="category-name">{category.name}</span>
                        <div className="category-bar">
                            <div
                                className="category-fill"
                                style={{
                                    width: `${category.score}%`,
                                    backgroundColor: getRiskLevel(category.score).color
                                }}
                            />
                        </div>
                        <span className="category-score">{category.score}%</span>
                    </div>
                ))}
            </div>

            <button className="detail-button">
                æŸ¥çœ‹è¯¦ç»†åˆ†æ â†’
            </button>
        </div>
    );
};

export default RiskCard;
```

### 7.3 æ ·å¼æ–‡ä»¶

```css
/* Assessment.css */
.assessment-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.assessment-content {
    display: grid;
    grid-template-columns: 1fr 350px;
    gap: 20px;
    margin-top: 20px;
}

/* ChatInterface.css */
.chat-interface {
    display: flex;
    flex-direction: column;
    height: 600px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.messages-container {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
}

.message {
    margin-bottom: 16px;
    max-width: 80%;
}

.user-message {
    margin-left: auto;
}

.assistant-message {
    margin-right: auto;
}

.message-content {
    background: #007bff;
    color: white;
    padding: 12px 16px;
    border-radius: 12px;
}

.assistant-message .message-content {
    background: #f1f3f5;
    color: #333;
}

.typing-indicator span {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #999;
    margin: 0 2px;
    animation: bounce 1.4s infinite ease-in-out both;
}

.typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
.typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

@keyframes bounce {
    0%, 80%, 100% { transform: scale(0); }
    40% { transform: scale(1); }
}

.message-input-form {
    display: flex;
    padding: 16px;
    border-top: 1px solid #eee;
    gap: 12px;
}

.message-input {
    flex: 1;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 24px;
    outline: none;
}

.send-button {
    padding: 12px 24px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 24px;
    cursor: pointer;
}

.quick-actions {
    display: flex;
    gap: 8px;
    padding: 12px 16px;
    background: #f8f9fa;
    border-top: 1px solid #eee;
}

.quick-action-btn {
    padding: 6px 12px;
    background: white;
    border: 1px solid #ddd;
    border-radius: 16px;
    font-size: 12px;
    cursor: pointer;
}

/* RiskCard.css */
.risk-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.risk-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 16px;
    border-bottom: 2px solid;
}

.risk-badge {
    padding: 6px 12px;
    border-radius: 16px;
    color: white;
    font-weight: bold;
}

.risk-score {
    text-align: center;
    padding: 20px 0;
}

.score-circle {
    display: inline-block;
    position: relative;
}

.score-value {
    font-size: 48px;
    font-weight: bold;
}

.score-total {
    font-size: 24px;
    color: #999;
}

.risk-findings ul {
    list-style: none;
    padding: 0;
}

.risk-findings li {
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}

.risk-categories {
    margin-top: 20px;
}

.risk-category-item {
    display: flex;
    align-items: center;
    margin-bottom: 12px;
}

.category-bar {
    flex: 1;
    height: 8px;
    background: #eee;
    border-radius: 4px;
    margin: 0 12px;
    overflow: hidden;
}

.category-fill {
    height: 100%;
    transition: width 0.3s ease;
}

.detail-button {
    width: 100%;
    padding: 12px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    margin-top: 20px;
    cursor: pointer;
}
```

---

## 8. æ•°æ®åº“è®¾è®¡

### 8.1 è¯„ä¼°ä¼šè¯è¡¨

```sql
CREATE TABLE assessment_session (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ä¸»é”®ID',
    chat_id VARCHAR(64) NOT NULL COMMENT 'å¯¹è¯ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    session_id VARCHAR(64) UNIQUE NOT NULL COMMENT 'ä¼šè¯å”¯ä¸€æ ‡è¯†',
    current_stage VARCHAR(32) DEFAULT 'INIT' COMMENT 'å½“å‰é˜¶æ®µ',
    assessment_type VARCHAR(64) COMMENT 'è¯„ä¼°ç±»å‹',
    context_json TEXT COMMENT 'ä¼šè¯ä¸Šä¸‹æ–‡JSON',
    file_ids VARCHAR(512) COMMENT 'å…³è”æ–‡ä»¶IDåˆ—è¡¨',
    status VARCHAR(32) DEFAULT 'ACTIVE' COMMENT 'çŠ¶æ€',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    INDEX idx_user_id (user_id),
    INDEX idx_session_id (session_id),
    INDEX idx_chat_id (chat_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è¯„ä¼°ä¼šè¯è¡¨';
```

### 8.2 è¯„ä¼°æŠ¥å‘Šè¡¨

```sql
CREATE TABLE assessment_report (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ä¸»é”®ID',
    session_id VARCHAR(64) NOT NULL COMMENT 'ä¼šè¯ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    report_type VARCHAR(32) COMMENT 'æŠ¥å‘Šç±»å‹',
    risk_level VARCHAR(16) COMMENT 'é£é™©ç­‰çº§',
    risk_score INT COMMENT 'é£é™©è¯„åˆ†',
    summary TEXT COMMENT 'æ‰§è¡Œæ‘˜è¦',
    findings_json TEXT COMMENT 'é£é™©å‘ç°JSON',
    recommendations_json TEXT COMMENT 'æ”¹è¿›å»ºè®®JSON',
    minio_path VARCHAR(256) COMMENT 'æŠ¥å‘Šæ–‡ä»¶è·¯å¾„',
    status VARCHAR(32) DEFAULT 'GENERATING' COMMENT 'çŠ¶æ€',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    INDEX idx_session_id (session_id),
    INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è¯„ä¼°æŠ¥å‘Šè¡¨';
```

### 8.3 ä¼šè¯æ¶ˆæ¯è¡¨

```sql
CREATE TABLE assessment_message (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ä¸»é”®ID',
    session_id VARCHAR(64) NOT NULL COMMENT 'ä¼šè¯ID',
    role VARCHAR(16) NOT NULL COMMENT 'è§’è‰²: user/assistant/system',
    content TEXT NOT NULL COMMENT 'æ¶ˆæ¯å†…å®¹',
    metadata_json TEXT COMMENT 'å…ƒæ•°æ®JSON',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    INDEX idx_session_id (session_id),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ä¼šè¯æ¶ˆæ¯è¡¨';
```

---

## 9. éƒ¨ç½²æ–¹æ¡ˆ

### 9.1 ç¯å¢ƒè¦æ±‚

| ç»„ä»¶ | ç‰ˆæœ¬è¦æ±‚ |
|------|---------|
| JDK | 17+ |
| Spring Boot | 3.x |
| MySQL | 8.0+ |
| Redis | 6.0+ |
| Milvus | 2.3+ |
| Node.js | 18+ |
| React | 18+ |

### 9.2 éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Nginx (åå‘ä»£ç†)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ (React)  â”‚                          â”‚ åç«¯ (Spring) â”‚
â”‚  Port: 3000   â”‚                          â”‚  Port: 8080   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              åŸºç¡€è®¾æ–½å±‚                              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚  MySQL  â”‚  â”‚  Redis  â”‚  â”‚  Milvus â”‚  â”‚  MinIO  â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.3 Dockeréƒ¨ç½²é…ç½®

```yaml
# docker-compose.yml
version: '3.8'

services:
  # å‰ç«¯
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    depends_on:
      - backend
    environment:
      - REACT_APP_API_URL=http://backend:8080

  # åç«¯
  backend:
    build: ./backend
    ports:
      - "8080:8080"
    depends_on:
      - mysql
      - redis
      - milvus
      - minio
    environment:
      - SPRING_PROFILES_ACTIVE=production
      - SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/legal_assistant
      - SPRING_REDIS_HOST=redis
      - AI_DASHSCOPE_API_KEY=${DASHSCOPE_API_KEY}

  # MySQL
  mysql:
    image: mysql:8.0
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=root123456
      - MYSQL_DATABASE=legal_assistant
    volumes:
      - mysql-data:/var/lib/mysql

  # Redis
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data

  # Milvus
  milvus:
    image: milvusdb/milvus:v2.3.0
    ports:
      - "19530:19530"
    volumes:
      - milvus-data:/var/lib/milvus

  # MinIO
  minio:
    image: minio/minio:latest
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      - MINIO_ROOT_USER=minioadmin
      - MINIO_ROOT_PASSWORD=minioadmin
    volumes:
      - minio-data:/data
    command: server /data --console-address ":9001"

volumes:
  mysql-data:
  redis-data:
  milvus-data:
  minio-data:
```

---

## 10. æµ‹è¯•è®¡åˆ’

### 10.1 å•å…ƒæµ‹è¯•

```java
@SpringBootTest
class AssessmentServiceTest {

    @Autowired
    private AssessmentService assessmentService;

    @Test
    void testStartAssessment() {
        StartAssessmentRequest request = new StartAssessmentRequest();
        request.setUserId(1L);
        request.setAssessmentType("CONTRACT_RISK_ASSESSMENT");
        request.setUserMessage("è¯„ä¼°ä¹°å–åˆåŒé£é™©");

        AssessmentResponse response = assessmentService.startAssessment(request);

        assertNotNull(response.getSessionId());
        assertEquals("COLLECTING", response.getCurrentStage());
        assertNotNull(response.getAgentResponse());
    }

    @Test
    void testContinueAssessment() {
        // æµ‹è¯•ç»§ç»­è¯„ä¼°
    }

    @Test
    void testGenerateReport() {
        // æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
    }
}
```

### 10.2 é›†æˆæµ‹è¯•åœºæ™¯

| åœºæ™¯ | æµ‹è¯•æ­¥éª¤ | é¢„æœŸç»“æœ |
|------|---------|---------|
| å®Œæ•´æµç¨‹ | 1. å¼€å§‹è¯„ä¼°<br>2. æä¾›ä¿¡æ¯<br>3. æŸ¥çœ‹åˆ†æ<br>4. æ·±å…¥äº†è§£<br>5. ç”ŸæˆæŠ¥å‘Š | æ¯ä¸ªé˜¶æ®µæ­£å¸¸æµè½¬ |
| è·³è¿‡é—®é¢˜ | åœ¨ä¿¡æ¯æ”¶é›†é˜¶æ®µç‚¹å‡»"è·³è¿‡" | è·³è¿‡å½“å‰é—®é¢˜ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ª |
| ç›´æ¥ç”ŸæˆæŠ¥å‘Š | åœ¨ä»»æ„é˜¶æ®µè¯´"ç”ŸæˆæŠ¥å‘Š" | è·³è¿‡åç»­æµç¨‹ï¼Œç”ŸæˆæŠ¥å‘Š |
| ä¸­æ–­æ¢å¤ | å…³é—­é¡µé¢åé‡æ–°æ‰“å¼€ | ä»ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹ç»§ç»­ |
| å¤šè½®æ·±å…¥ | å¤šæ¬¡è¦æ±‚æ·±å…¥åˆ†æ | æ¯æ¬¡éƒ½æä¾›ä¸åŒæ–¹é¢çš„è¯¦ç»†åˆ†æ |

### 10.3 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ |
|------|--------|
| å“åº”æ—¶é—´ | < 3ç§’ |
| å¹¶å‘ç”¨æˆ· | > 100 |
| ä¼šè¯å­˜å‚¨æ—¶é—´ | > 30å¤© |
| æŠ¥å‘Šç”Ÿæˆæ—¶é—´ | < 10ç§’ |

---

## é™„å½•

### A. é…ç½®æ–‡ä»¶ç¤ºä¾‹

```yaml
# application.yml
agent:
  risk-assessment:
    max-iterations: 10
    temperature: 0.7

assessment:
  session:
    timeout: 1800  # 30åˆ†é’Ÿ
    max-messages: 50

report:
  template-path: /templates/risk-report/
  storage-path: /reports/
```

### B. APIæ¥å£æ–‡æ¡£

è¯¦è§ Swagger æ–‡æ¡£ï¼š`http://localhost:8080/swagger-ui.html`

### C. å¸¸è§é—®é¢˜

**Q: å¦‚ä½•è‡ªå®šä¹‰è¯„ä¼°æµç¨‹ï¼Ÿ**
A: ä¿®æ”¹`InteractiveRiskAssessmentAgent`çš„ç³»ç»Ÿæç¤ºè¯ï¼Œè°ƒæ•´é˜¶æ®µåˆ’åˆ†å’Œè¾“å‡ºæ ¼å¼ã€‚

**Q: å¦‚ä½•æ·»åŠ æ–°çš„å·¥å…·ï¼Ÿ**
A: åˆ›å»ºæ–°çš„ToolServiceç±»ï¼Œä½¿ç”¨`@Tool`æ³¨è§£å®šä¹‰å·¥å…·æ–¹æ³•ï¼Œåœ¨Agentä¸­æ³¨å†Œã€‚

**Q: å¦‚ä½•æ”¯æŒå¤šè¯­è¨€ï¼Ÿ**
A: åœ¨æç¤ºè¯ä¸­æ·»åŠ è¯­è¨€æ£€æµ‹å’Œåˆ‡æ¢é€»è¾‘ï¼Œæˆ–ä½¿ç”¨å›½é™…åŒ–å·¥å…·ã€‚

---

**æ–‡æ¡£ç»“æŸ**
